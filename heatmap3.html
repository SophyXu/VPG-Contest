<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
    <style>
      rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;   
      }
      text.mono {
        font-size: 9pt;
        font-family: Consolas, courier;
        fill: #aaa;
      }
      text.axis-workweek {
        fill: #000;
      }
      text.axis-worktime {
        fill: #000;
      }
    </style>
    <script src="http://d3js.org/d3.v3.js"></script>
  </head>
  <body>
    <div id="chart1"></div>
    <div id="chart2"></div>
    <div id="chart3"></div>

    <script type="text/javascript">
      var margin = { top: 50, right: 0, bottom: 100, left: 30 },
          width = 960 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom,
          gridSize = Math.floor(width / 36),
          legendElementWidth = gridSize*2,
          buckets = 9,
          colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],
          majors = ["Agr", "Arc", "Are", "Art", "Bus", "Com", "Com", "C&M", "Edu", "E&D", "Eng", "E&F", "H&A", "H&T", "Phi", "Rep", "Sci", "Soc"],
          matchs = ["Agr", "Arc", "Are", "Art", "Bus", "Com", "Com", "C&M", "Edu", "E&D", "Eng", "E&F", "H&A", "H&T", "Phi", "Rep", "Sci", "Soc"],
          range = [0, 1420, 2840, 4260, 5680, 7100, 8520, 9940, 11360];
          var number_1 = new Array();
          var number_2 = new Array();
          var number_3 = new Array();

          var array_1 = new Array();
          var array_2 = new Array();
          var array_3 = new Array();
          var sum_1 = new Array();
          var sum_2 = new Array();
          var sum_3 = new Array();
          var max_1 = 0;
          var max_2 = 0;
          var max_3 = 0;

          for(var i = 0; i < 18; ++i){
            array_1[i] = new Array();
            array_2[i] = new Array();
            array_3[i] = new Array();
            number_1[i] = 0;
            number_2[i] = 0;
            number_3[i] = 0;
            for(var j = 0; j < 18; ++j){
              array_1[i][j] = 0;
              array_2[i][j] = 0;
              array_3[i][j] = 0;
            }
          }

          d3.csv("student.csv", function(d) {
              var i = major2index(d.T1_Level2);
              var j = major2index(d.HighestLevel2);
              
              array_1[i][j] += d.count/1;
              number_1[i] += d.count/1;

              i = major2index(d.T2_Level2);
              array_2[i][j] += d.count/1;
              number_2[i] += d.count/1;

              i = major2index(d.T3_Level2);
              array_3[i][j] += d.count/1;             
              number_3[i] += d.count/1; 

              return {
              };
            },
            function(error, data) {
                for(var i = 0; i < 18; ++i)
                  for(var j = 0; j < 18; ++j) {
                    sum_1[i*18+j] = array_1[i][j];

                    sum_2[i*18+j] = array_2[i][j];

                    if(array_3[i][j] > max_3)
                      max_3 = array_3[i][j];
                    sum_3[i*18+j] = array_3[i][j];
                  }

                // Major number scale of the first year
                var numberScale = d3.scale.linear().domain([d3.min(number_1), d3.max(number_1)]).range([10,75]);
 
                var svg = d3.select("#chart1").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                var matchLabels = svg.selectAll(".matchLabel")
                    .data(matchs)
                    .enter().append("text")
                      .text(function (d) { return d; })
                      .attr("x", 0)
                      .attr("y", function (d, i) { return i * gridSize; })
                      .style("text-anchor", "end")
                      .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                      .attr("class", function (d, i) { return ((i >= 0 && i <= 17) ? "matchLabel mono axis axis-workweek" : "matchLabel mono axis"); });
                var majorLabels = svg.selectAll(".majorLabel")
                    .data(majors)
                    .enter().append("text")
                      .text(function(d) { return d; })
                      .attr("x", function(d, i) { return i * gridSize; })
                      .attr("y", 0)
                      .style("text-anchor", "middle")
                      .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                      .attr("class", function(d, i) { return ((i >= 0 && i <= 17) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); });
                var heatMap = svg.selectAll(".hit")
                    .data(sum_1)
                    .enter().append("rect")
                    .attr("x", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (i%18); ++t) {
                        len += numberScale(number_1[t]);
                      }
                      return len; 
                    })
                    .attr("y", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (Math.floor(i/18)); ++t) {
                        len += numberScale(number_1[t]);
                      } 
                      return len; 
                    })
                    .attr("rx", 4)
                    .attr("ry", 4)
                    .attr("class", "hour bordered")
                    .attr("width", function(d, i) {return numberScale(number_1[i%18]); })
                    .attr("height", function(d, i) {return numberScale(number_1[Math.floor(i/18)]); })
                    .style("fill", colors[0]);
                heatMap.transition().duration(1000)
                    .style("fill", function(d) { 
                      for (var i = 1; i < range.length; ++i) {
                        if(d <= range[i])
                          return colors[i-1];
                      }
                      return colors[range.length - 2]; 
                    });
                heatMap.append("title").text(function(d) { return d; });

                var legend = svg.selectAll(".legend")
                    .data(range)
                    .enter().append("g")
                    .attr("class", "legend");
                legend.append("rect")
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + 10)
                  .attr("width", legendElementWidth)
                  .attr("height", gridSize / 2)
                  .style("fill", function(d, i) { return colors[i]; });
                legend.append("text")
                  .attr("class", "mono")
                  .text(function(d) { return "≥ " + d; })
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + gridSize + 10);
              
          });
          d3.csv("student.csv", function(d) {
              return {
              };
            },
            function(error, data) {
                var numberScale = d3.scale.linear().domain([d3.min(number_2), d3.max(number_2)]).range([10,52]);

                var svg = d3.select("#chart2").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                var matchLabels = svg.selectAll(".matchLabel")
                    .data(matchs)
                    .enter().append("text")
                      .text(function (d) { return d; })
                      .attr("x", 0)
                      .attr("y", function (d, i) { return i * gridSize; })
                      .style("text-anchor", "end")
                      .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                      .attr("class", function (d, i) { return ((i >= 0 && i <= 17) ? "matchLabel mono axis axis-workweek" : "matchLabel mono axis"); });
                var majorLabels = svg.selectAll(".majorLabel")
                    .data(majors)
                    .enter().append("text")
                      .text(function(d) { return d; })
                      .attr("x", function(d, i) { return i * gridSize; })
                      .attr("y", 0)
                      .style("text-anchor", "middle")
                      .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                      .attr("class", function(d, i) { return ((i >= 0 && i <= 17) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); });
                var heatMap = svg.selectAll(".hit")
                    .data(sum_2)
                    .enter().append("rect")
                    .attr("x", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (i%18); ++t) {
                        len += numberScale(number_2[t]);
                      }
                      return len; 
                    })
                    .attr("y", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (Math.floor(i/18)); ++t) {
                        len += numberScale(number_2[t]);
                      } 
                      return len; 
                    })
                    .attr("rx", 4)
                    .attr("ry", 4)
                    .attr("class", "hour bordered")
                    .attr("width", function(d, i) {return numberScale(number_2[i%18]); })
                    .attr("height", function(d, i) {return numberScale(number_2[Math.floor(i/18)]); })
                    .style("fill", colors[0]);
                heatMap.transition().duration(1000)
                    .style("fill", function(d) { 
                      for (var i = 1; i < range.length; ++i) {
                        if(d <= range[i])
                          return colors[i-1];
                      }
                      return colors[range.length - 2]; 
                    });
                heatMap.append("title").text(function(d) { return d; });

                var legend = svg.selectAll(".legend")
                    .data(range)
                    .enter().append("g")
                    .attr("class", "legend");
                legend.append("rect")
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + 10)
                  .attr("width", legendElementWidth)
                  .attr("height", gridSize / 2)
                  .style("fill", function(d, i) { return colors[i]; });
                legend.append("text")
                  .attr("class", "mono")
                  .text(function(d) { return "≥ " + d; })
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + gridSize + 10);
              
          });
          d3.csv("student.csv", function(d) {
              return {
              };
            },
            function(error, data) {
                var numberScale = d3.scale.linear().domain([d3.min(number_2), d3.max(number_2)]).range([10,52]);

                var svg = d3.select("#chart3").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                var matchLabels = svg.selectAll(".matchLabel")
                    .data(matchs)
                    .enter().append("text")
                      .text(function (d) { return d; })
                      .attr("x", 0)
                      .attr("y", function (d, i) { return i * gridSize; })
                      .style("text-anchor", "end")
                      .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                      .attr("class", function (d, i) { return ((i >= 0 && i <= 17) ? "matchLabel mono axis axis-workweek" : "matchLabel mono axis"); });
                var majorLabels = svg.selectAll(".majorLabel")
                    .data(majors)
                    .enter().append("text")
                      .text(function(d) { return d; })
                      .attr("x", function(d, i) { return i * gridSize; })
                      .attr("y", 0)
                      .style("text-anchor", "middle")
                      .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                      .attr("class", function(d, i) { return ((i >= 0 && i <= 17) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); });
                var heatMap = svg.selectAll(".hit")
                    .data(sum_3)
                    .enter().append("rect")
                    .attr("x", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (i%18); ++t) {
                        len += numberScale(number_3[t]);
                      }
                      return len; 
                    })
                    .attr("y", function(d, i) {
                      var len = 0;
                      for (var t = 0; t < (Math.floor(i/18)); ++t) {
                        len += numberScale(number_3[t]);
                      } 
                      return len; 
                    })
                    .attr("rx", 4)
                    .attr("ry", 4)
                    .attr("class", "hour bordered")
                    .attr("width", function(d, i) {return numberScale(number_3[i%18]); })
                    .attr("height", function(d, i) {return numberScale(number_3[Math.floor(i/18)]); })
                    .style("fill", colors[0]);
                heatMap.transition().duration(1000)
                    .style("fill", function(d) { 
                      for (var i = 1; i < range.length; ++i) {
                        if(d <= range[i])
                          return colors[i-1];
                      }
                      return colors[range.length - 2]; 
                    });
                heatMap.append("title").text(function(d) { return d; });

                var legend = svg.selectAll(".legend")
                    .data(range)
                    .enter().append("g")
                    .attr("class", "legend");
                legend.append("rect")
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + 10)
                  .attr("width", legendElementWidth)
                  .attr("height", gridSize / 2)
                  .style("fill", function(d, i) { return colors[i]; });
                legend.append("text")
                  .attr("class", "mono")
                  .text(function(d) { return "≥ " + d; })
                  .attr("x", function(d, i) { return legendElementWidth * i; })
                  .attr("y", height + gridSize + 10);
              
          });
          function major2index(major) {
            var num = 0;
            if(major == "Agric. & Nat. Res. Cons") num = 0;
            if(major == "Architecture") num = 1;
            if(major == "Area, Eth. & Multidiscip. Studies") num = 2;
            if(major == "Arts: Visual & Performing") num = 3;
            if(major == "Business") num = 4;
            if(major == "Commun, Fam., & Personal Svcs") num = 5;
            if(major == "Communications") num = 6;
            if(major == "Comp. Sci. & Mathematics") num = 7;
            if(major == "Education") num = 8;
            if(major == "Eng. Tech. & Drafting") num = 9;
            if(major == "Engineering") num = 10;
            if(major == "English & Foreign Lang.") num = 11;
            if(major == "Health Admin. & Assisting") num = 12;
            if(major == "Health Sci. & Techno.") num = 13;
            if(major == "Philosophy, Religion, & Theology") num = 14;
            if(major == "Repair, Production, & Construction") num = 15;
            if(major == "Sciences: Biological & Physical") num = 16;
            if(major == "Social Sciences & Law") num = 17;
            return num;
          }
    </script>
  </body>
</html>